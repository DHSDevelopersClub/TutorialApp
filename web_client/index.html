<!DOCTYPE html>
<!-- Main page for web client.

Implement the action bar with search.  Use `history.pushState(...)` and
`history.replaceState(...)` when the user is searching so the search state is
always saved.  See `https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Manipulating_the_browser_history`
and `https://developer.mozilla.org/en-US/docs/WindowEventHandlers.onpopstate`
for more on history manipulation.

Include the `local-date-spinner` and the `local-classroom-manager` element in
content area.

Author: Jessica Gerwin
Author: Alexander Otavka
-->

<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Signed - Drake High School</title>

        <!-- Polymer setup. -->
        <script src="/res/components/webcomponentsjs/webcomponents.min.js"></script>
        <link rel="import" href="res/components/polymer/polymer.html" />

        <!-- Third party scripts. -->
<!--        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>-->
        <!--<script src="https://gist.githubusercontent.com/Sjeiti/2948738/raw/dc9f90e700b3c54809d21ec20fcbca26de26678a/getLessVars.js">
        </script>-->

        <!-- Imports to third party components. -->
        <link rel="import" href="/res/components/core-animation/core-animation.html" />
        <link rel="import" href="/res/components/core-animation/core-animation-group.html" />
        <link rel="import" href="/res/components/core-icons/core-icons.html" />
        <link rel="import" href="/res/components/core-toolbar/core-toolbar.html" />
        <link rel="import" href="/res/components/paper-icon-button/paper-icon-button.html" />

        <!-- Imports to local components at /res/components/local-*. -->
        <link rel="import" href="/res/components/local-classroom-manager/local-classroom-manager.html" />
        <link rel="import" href="/res/components/local-date-spinner/local-date-spinner.html" />
        <link rel="import" href="/res/components/local-search-bar/local-search-bar.html" />

        <!-- Local stylesheets and JavaScript. -->
        <link rel="stylesheet" type="text/css" href="/res/web_client/main.css" shim-shadowdom />
    </head>

    <body unresolved fullbleed vertical layout>
        <core-toolbar id="actionBar">
            <div id="navWrapper" class="noselect">
                <div id="navTitle" class="title">Signed</div>
                <div id="navBack" horizontal center layout hidden="">
                    <paper-icon-button id="backButton"
                                       icon="arrow-back">
                    </paper-icon-button>
                    <div id="navBackText" class="title">Search</div>
                </div>
            </div>

            <local-search-bar id="searchBar" flex></local-search-bar>

            <div id="actionButtons" class="noselect">
                <paper-icon-button id="refreshButton" icon="refresh"></paper-icon-button>
<!--                <div style="display: inline-block; width: 4px; height: 10px;"></div>-->
                <paper-icon-button id="moreButton" icon="more-vert"></paper-icon-button>
            </div>
        </core-toolbar>

        <div id="contentWrapper" vertical center layout>
            <div id="contentArea" vertical layout>
                <local-date-spinner date="2015-01-07"></local-date-spinner>
                <local-classroom-manager id="classroomManager"></local-classroom-manager>
            </div>
        </div>

        <script type="text/javascript">
            window.addEventListener("polymer-ready", function () {
                var MEDIA_MOBILE = window.matchMedia("(max-width: 640px)");

                /* Center search bar. */
                var navWrapper = document.getElementById("navWrapper");
                var navBackText = document.getElementById("navBackText");
                var actionButtons = document.getElementById("actionButtons");
                var centerSearchBar = function (animate) {
                    navWrapper.style.width = "auto";
                    actionButtons.style.width = "auto";
                    var widthMargin = Math.max(actionButtons.offsetWidth, navWrapper.offsetWidth) + 2;
                    if (animate) {
                        console.log("TODO animate centerSearchBar");
                    } else {
                        navWrapper.style.width = widthMargin + "px";
                        actionButtons.style.width = widthMargin + "px";
                    }
                }
                var checkSizing = function () {
                    centerSearchBar();
                }
                checkSizing();
                MEDIA_MOBILE.addListener(checkSizing);

                /* Configure transition animation. */
                var searchAnimation = (function () {
                    var green = "#4CB04F";
                    var grey = "#ABABAB";

                    var anim = new CoreAnimationGroup();
                    anim.type = "par";
                    anim.duration = 200;

                    var bg = new CoreAnimation();
                    bg.target = document.getElementById("actionBar");
                    bg.fill = "forwards";
                    bg.keyframes = [
                        {backgroundColor: green},
                        {backgroundColor: grey},
                    ];
                    anim.appendChild(bg);

                    var buttons = new CoreAnimation();
                    buttons.target = document.getElementById("actionButtons");
                    buttons.fill = "forwards";
                    buttons.keyframes = [
                        {opacity: 1},
                        {opacity: 0},
                    ];
                    anim.appendChild(buttons);

                    var nav = new CoreAnimation();
                    nav.target = document.getElementById("navWrapper");
                    nav.fill = "forwards";
                    var default_nav_keyframes = [
                        {opacity: 0, left: "-15px"},
                        {opacity: 1, left: "0px"},
                    ];
                    var reverse_nav_keyframes = [
                        {left: "15px"},
                        {left: "0px"},
                    ];
                    nav.keyframes = default_nav_keyframes;
                    anim.appendChild(nav);

                    anim.playReverse = function () {
                        bg.direction = "reverse";
                        buttons.direction = "reverse";
                        nav.keyframes = reverse_nav_keyframes;
                        anim.play();
                        bg.direction = "normal";
                        buttons.direction = "normal";
                        nav.keyframes = default_nav_keyframes;
                    }

                    return anim;
                })();

                /* Add tap and change event listeners for search. */
                var searchBar = document.getElementById("searchBar");
                var searchBoxWrapper;
                try {
                    searchBoxWrapper = document.querySelector("#searchBar::shadow #boxWrapper");
                } catch(error) {
                    searchBoxWrapper = document.querySelector("#searchBar").$.boxWrapper;
                }
                var navTitle = document.getElementById("navTitle");
                var navBack = document.getElementById("navBack");
                var clearSearchSizing = function () {
                    actionButtons.removeAttribute("hidden");
                    navBackText.removeAttribute("hidden");
                    searchBoxWrapper.style.textAlign = "center";
                }
                var checkSearchSizing = function () {
                    if (MEDIA_MOBILE.matches) {
                        actionButtons.setAttribute("hidden", "");
                        navBackText.setAttribute("hidden", "");
                        searchBoxWrapper.style.textAlign = "left";
                    } else {
                        clearSearchSizing();
                    }
                    centerSearchBar();
                }
                searchBar.addEventListener("click", function () { //"search-mode-enable", function () {
                    navTitle.setAttribute("hidden", "");
                    navBack.removeAttribute("hidden");

                    searchAnimation.play();
                    checkSearchSizing();
                    MEDIA_MOBILE.addListener(checkSearchSizing);

                    centerSearchBar();
                });
                searchBar.addEventListener("search-change", function () {
                    console.log("TODO search changed to '" + searchBar.search + "'");
                });

                /* Add click event listener for back button. */
                var backButton = document.getElementById("backButton");
                backButton.addEventListener("click", function () {
                    navBack.setAttribute("hidden", "");
                    navTitle.removeAttribute("hidden");

                    searchBar.disableSearchMode();
                    searchAnimation.playReverse();
                    MEDIA_MOBILE.removeListener(checkSearchSizing);
                    clearSearchSizing();

                    centerSearchBar();
                });
            });
        </script>
    </body>
</html>
